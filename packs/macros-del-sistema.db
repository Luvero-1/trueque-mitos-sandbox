{"name":"Generador de escenarios","permission":{"default":0,"eUp50nEprJoNBigj":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.mMYYkTsweEBaZyQK"}},"scope":"global","command":"let table1 = game.tables.getName(\"1-1 - Impulso inicial\")\nlet table2 = game.tables.getName(\"1-2 - Lugar central\")\nlet table3 = game.tables.getName(\"1-3 - Paisaje\")\nlet table4 = game.tables.getName(\"1-4 - Elemento recurrente\")\nlet table5 = game.tables.getName(\"2 - Rumores\")\nlet table6 = game.tables.getName(\"2 - Rumores\")\nlet table7 = game.tables.getName(\"2 - Rumores\")\nlet table8 = game.tables.getName(\"3-1 - Un simple enemigo desconocido...\")\nlet table9 = game.tables.getName(\"3-2 - ...conducido por una oscura motivación...\")\nlet table10 = game.tables.getName(\"3-3 - ...y que rinde tributo a...\")\nlet table11 = game.tables.getName(\"4-1 - ¿Un amigo inesperado?...\")\nlet table12 = game.tables.getName(\"4-2 - ...con un  carácter...\")\nlet table13 = game.tables.getName(\"4-3 - ...que esconde un secreto para los protagonistas\")\n\nlet roll1 = table1.roll().results[0].text;\nlet roll2 = table2.roll().results[0].text;\nlet roll3 = table3.roll().results[0].text;\nlet roll4 = table4.roll().results[0].text;\nlet roll5 = table5.roll().results[0].text;\nlet roll6 = table6.roll().results[0].text;\nlet roll7 = table7.roll().results[0].text;\nlet roll8 = table8.roll().results[0].text;\nlet roll9 = table9.roll().results[0].text;\nlet roll10 = table10.roll().results[0].text;\nlet roll11 = table11.roll().results[0].text;\nlet roll12 = table12.roll().results[0].text;\nlet roll13 = table13.roll().results[0].text;\n\nlet content = `${roll1}<br> ${roll2}.<br> ${roll3}.<br> Elemento recurrente: ${roll4}.<br> Rumor 1: ${roll5}.<br> Rumor 2: ${roll6}.<br> Rumor 3: ${roll7}.<br> ${roll8}.<br> ${roll9}.<br> ${roll10}.<br> ${roll11}.<br> ${roll12}.<br> ${roll13}`\n\nChatMessage.create({content: content})","author":"eUp50nEprJoNBigj","img":"modules/game-icons-net/blackbackground/perspective-dice-six-faces-random.svg","actorIds":[],"_id":"3twUVcXmUoUjG6rK"}
{"_id":"9MtQUGR3DdkG3TyF","name":"Apoyo","permission":{"default":0,"eUp50nEprJoNBigj":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.4OnMFZc3eCAkP7YD"}},"scope":"global","command":"let table1 = game.tables.getName(\"4-1 - ¿Un amigo inesperado?...\")\nlet table2 = game.tables.getName(\"4-2 - ...con un  carácter...\")\nlet table3 = game.tables.getName(\"4-3 - ...que esconde un secreto para los protagonistas\")\n\nlet roll1 = table1.roll().results[0].text;\nlet roll2 = table2.roll().results[0].text;\nlet roll3 = table3.roll().results[0].text;\n\nlet content = `${roll1}<br> ${roll2}.<br> ${roll3}`\n\nChatMessage.create({content: content})","author":"eUp50nEprJoNBigj","img":"icons/svg/dice-target.svg","actorIds":[]}
{"name":"Generador del horror","permission":{"default":0,"eUp50nEprJoNBigj":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.0JmK708n83ZVoA7p"}},"scope":"global","command":"let table1 = game.tables.getName(\"Apariciones\")\nlet table2 = game.tables.getName(\"Quebrantos\")\n\nlet roll1 = table1.roll().results[0].text;\nlet roll2 = table2.roll().results[0].text;\n\nlet content = `Aparición: ${roll1}<br> Quebranto: ${roll2}.<br>`\n\nChatMessage.create({content: content})","author":"eUp50nEprJoNBigj","img":"modules/game-icons-net/blackbackground/light-thorny-triskelion.svg","actorIds":[],"_id":"C4qjyoo8vhbnbIMy"}
{"name":"Ficha de pj/pnj","permission":{"default":0,"eUp50nEprJoNBigj":3},"type":"script","flags":{"core":{"sourceId":"Macro.0D8myuoDEkTwVvBb"}},"scope":"global","command":"fromUuid(\"Actor.ho0oFFjyn6b8LeV2\").then(entity => entity.sheet.render(true))","author":"eUp50nEprJoNBigj","img":"modules/game-icons-net/blackbackground/swordman.svg","actorIds":[],"_id":"OVXTN1Ac2gIbMxWe"}
{"_id":"cLi3a7S39AoJC9LT","name":"Escenario","permission":{"default":0,"eUp50nEprJoNBigj":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.KPlE9QYqObZIufZE"}},"scope":"global","command":"let table1 = game.tables.getName(\"1-1 - Impulso inicial\")\nlet table2 = game.tables.getName(\"1-2 - Lugar central\")\nlet table3 = game.tables.getName(\"1-3 - Paisaje\")\n\nlet roll1 = table1.roll().results[0].text;\nlet roll2 = table2.roll().results[0].text;\nlet roll3 = table3.roll().results[0].text;\n\nlet content = `${roll1}<br> ${roll2}.<br> ${roll3}`\n\nChatMessage.create({content: content})","author":"eUp50nEprJoNBigj","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"ejzW6ctQobeMVWss","name":"Generador de escenarios","permission":{"default":0,"eUp50nEprJoNBigj":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.mMYYkTsweEBaZyQK"}},"scope":"global","command":"let table1 = game.tables.getName(\"1-1 - Impulso inicial\")\nlet table2 = game.tables.getName(\"1-2 - Lugar central\")\nlet table3 = game.tables.getName(\"1-3 - Paisaje\")\nlet table4 = game.tables.getName(\"1-4 - Elemento recurrente\")\nlet table5 = game.tables.getName(\"2 - Rumores\")\nlet table6 = game.tables.getName(\"2 - Rumores\")\nlet table7 = game.tables.getName(\"2 - Rumores\")\nlet table8 = game.tables.getName(\"3-1 - Un simple enemigo desconocido...\")\nlet table9 = game.tables.getName(\"3-2 - ...conducido por una oscura motivación...\")\nlet table10 = game.tables.getName(\"3-3 - ...y que rinde tributo a...\")\nlet table11 = game.tables.getName(\"4-1 - ¿Un amigo inesperado?...\")\nlet table12 = game.tables.getName(\"4-2 - ...con un  carácter...\")\nlet table13 = game.tables.getName(\"4-3 - ...que esconde un secreto para los protagonistas\")\n\nlet roll1 = table1.roll().results[0].text;\nlet roll2 = table2.roll().results[0].text;\nlet roll3 = table3.roll().results[0].text;\nlet roll4 = table4.roll().results[0].text;\nlet roll5 = table5.roll().results[0].text;\nlet roll6 = table6.roll().results[0].text;\nlet roll7 = table7.roll().results[0].text;\nlet roll8 = table8.roll().results[0].text;\nlet roll9 = table9.roll().results[0].text;\nlet roll10 = table10.roll().results[0].text;\nlet roll11 = table11.roll().results[0].text;\nlet roll12 = table12.roll().results[0].text;\nlet roll13 = table13.roll().results[0].text;\n\nlet content = `${roll1}<br> ${roll2}.<br> ${roll3}.<br> Elemento recurrente: ${roll4}.<br> Rumor 1: ${roll5}.<br> Rumor 2: ${roll6}.<br> Rumor 3: ${roll7}.<br> ${roll8}.<br> ${roll9}.<br> ${roll10}.<br> ${roll11}.<br> ${roll12}.<br> ${roll13}`\n\nChatMessage.create({content: content})","author":"eUp50nEprJoNBigj","img":"icons/svg/dice-target.svg","actorIds":[]}
{"name":"Encender y apagar luces locales","permission":{"default":0,"eUp50nEprJoNBigj":3},"type":"script","flags":{"core":{"sourceId":"Macro.SgVz00aaw2bmFiQk"}},"scope":"global","command":"canvas.lighting.updateAll({hidden: canvas.lighting.placeables[0].data.hidden == true ? false : true})","author":"eUp50nEprJoNBigj","img":"modules/game-icons-net/blackbackground/bed-lamp.svg","actorIds":[],"_id":"hxlqJn8AfRtQ8CZY"}
{"name":"Luces programadas","permission":{"default":0,"eUp50nEprJoNBigj":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.dGgR9q531kLppsuZ"}},"scope":"global","command":"if (canvas.tokens.controlled.length === 0)\n  ui.notifications.error(\"Please select a token\");\n\nlet namedfields = (...fields) => {\n  return (...arr) => {\n    var obj = {};\n    fields.forEach((field, index) => {\n      obj[field] = arr[index];\n    });\n    return obj;\n  };\n};\n\n// Very ugly automated construction below. DRY, but at what cost?\nlet VisionType = namedfields('name', 'dim', 'bright');\nvar visions = (() => {\n  return [\n    VisionType('Leave Unchanged', null, null),\n    VisionType('Self', 5, 0),\n    VisionType('Devil\\'s Sight', 0, 120)\n  ].concat(...[...Array(6).keys()].map(x => (x+1)*30).map(n => {\n    return VisionType(`Darkvision (${n} feet)`, n, 0);\n  }));\n})();\n\nlet LightSource = namedfields('name', 'dim', 'bright', 'angle', 'lockRotation')\nvar lightSources = [\n  LightSource('Leave Unchanged', null, null, null, null),\n  LightSource('None', 0, 0, 360, null),\n  LightSource('Candle', 2, 1, 360, null),\n  LightSource('Torch / Light Cantrip', 5, 2, 360, null),\n  LightSource('Lamp', 7, 3, 360, null),\n  LightSource('Hooded Lantern', 8, 4, 360, null),\n  LightSource('Hooded Lantern (Dim)', 5, 0, 360, null),\n  LightSource('Bullseye Lantern', 10, 5, 52.5, false)\n];\n\nlet applyChanges = false;\nnew Dialog({\n  title: `Token Vision Configuration`,\n  content: `\n<form>\n  <div class=\"form-group\">\n    <label>Vision Type:</label>\n    <select id=\"vision-type\" name=\"vision-type\">\n      ${\n        visions.map((vision, index) => {\n          return `\\t<option value=${index}>${vision.name}</option>`;\n        }).join('\\n')\n      }\n    </select>\n  </div>\n  <div class=\"form-group\">\n    <label>Light Source:</label>\n    <select id=\"light-source\" name=\"light-source\">\n      ${\n        lightSources.map((lightSource, index) => {\n          return `\\t<option value=${index}>${lightSource.name}</option>`;\n        }).join('\\n')\n      }\n    </select>\n  </div>\n  <div class=\"form-group\">\n    <label>Duration in Minutes:</label>\n    <input type=\"number\" id=\"duration\" name=\"duration\" min=\"0\">\n  </div>\n</form>\n`,\n  buttons: {\n    yes: {\n      icon: \"<i class='fas fa-check'></i>\",\n      label: `Apply Changes`,\n      callback: () => applyChanges = true\n    },\n    no: {\n      icon: \"<i class='fas fa-times'></i>\",\n      label: `Cancel Changes`\n    },\n  },\n  default: \"yes\",\n  close: html => {\n    if (applyChanges) {\n      for ( let token of canvas.tokens.controlled ) {\n        let visionIndex = parseInt(html.find('[name=\"vision-type\"]')[0].value) || 0;\n        let lightIndex = parseInt(html.find('[name=\"light-source\"]')[0].value) || 0;\n        let duration = parseInt(html.find('[name=\"duration\"]')[0].value) || 0;\n\n        if (duration > 0) {\n          if (game.modules.get(\"about-time\").active != true) {\n            ui.notifications.error(\"About Time isn't loaded\");\n          } else {\n            ((backup) => {\n              game.Gametime.doIn({minutes:Math.floor(3 * duration / 4)}, () => {\n                ChatMessage.create({\n                  user: game.user._id,\n                  content: \"The fire burns low...\",\n                  speaker: speaker\n                }, {});\n              });\n            })(Object.assign({}, token.data));\n            ((backup) => {\n              game.Gametime.doIn({minutes:duration}, () => {\n                ChatMessage.create({\n                  user: game.user._id,\n                  content: \"The fire goes out, leaving you in darkness.\",\n                  speaker: speaker\n                }, {});\n                token.update({\n                  vision: true,\n                  dimSight: backup.dimSight,\n                  brightSight: backup.brightSight,\n                  dimLight: backup.dimLight,\n                  brightLight:  backup.brightLight,\n                  lightAngle: backup.lightAngle,\n                  lockRotation: backup.lockRotation\n                });\n              });\n            })(Object.assign({}, token.data));\n          }\n        }\n\n        // Configure new token vision\n        let dimSight = visions[visionIndex].dim ?? token.data.dimSight;\n        let brightSight = visions[visionIndex].bright ?? token.data.brightSight;\n        let dimLight = lightSources[lightIndex].dim ?? token.data.dimLight;\n        let brightLight = lightSources[lightIndex].bright ?? token.data.brightLight;\n        let lightAngle = lightSources[lightIndex].angle ?? token.data.lightAngle;\n        let lockRotation = lightSources[lightIndex].lockRotation ?? token.data.lockRotation;\n\n        // Update Token\n        console.log(token);\n        token.update({\n          vision: true,\n          dimSight: dimSight,\n          brightSight: brightSight,\n          dimLight: dimLight,\n          brightLight:  brightLight,\n          lightAngle: lightAngle,\n          lockRotation: lockRotation\n        });\n      }\n    }\n  }\n}).render(true);","author":"eUp50nEprJoNBigj","img":"modules/game-icons-net/blackbackground/flashlight.svg","actorIds":[],"_id":"meZpKRjONjCxnzc6"}
{"name":"Encender y apagar luz global","permission":{"default":0,"eUp50nEprJoNBigj":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.Tp9n2M1zcZAWJ14M"}},"scope":"global","command":"async function main() {\n  if (canvas.scene.data.darkness === 0.0) {\n    await canvas.scene.update({globalLight: false}) // turn global light off\n    canvas.scene.update({darkness: 1.0}, {animateDarkness: true}) // make it night\n  } else {\n    await canvas.scene.update({darkness: 0.0}, {animateDarkness: true}) // make it day \n    await new Promise(resolve => setTimeout(resolve, 10000));\n    canvas.scene.update({globalLight: true}) // turn global light on\n  }\n}\nmain();","author":"eUp50nEprJoNBigj","img":"modules/game-icons-net/blackbackground/sunrise.svg","actorIds":[],"_id":"qnFe5rmeLr6QoiNu"}
{"_id":"tidNYRfyDMNAwfxF","name":"Objeto recurrente","permission":{"default":0,"eUp50nEprJoNBigj":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.nJodpK7nlmI6Er0S"}},"scope":"global","command":"let table1 = game.tables.getName(\"1-4 - Elemento recurrente\")\n\nlet roll1 = table1.roll().results[0].text;\n\nlet content = `Elemento recurrente: ${roll1}<br>`\n\nChatMessage.create({content: content})","author":"eUp50nEprJoNBigj","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"vPRAoFroUUoV7NxL","name":"Enemigo y el Horror","permission":{"default":0,"eUp50nEprJoNBigj":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.S3BXLbkaVJKIuuM5"}},"scope":"global","command":"let table1 = game.tables.getName(\"3-1 - Un simple enemigo desconocido...\")\nlet table2 = game.tables.getName(\"3-2 - ...conducido por una oscura motivación...\")\nlet table3 = game.tables.getName(\"3-3 - ...y que rinde tributo a...\")\n\nlet roll1 = table1.roll().results[0].text;\nlet roll2 = table2.roll().results[0].text;\nlet roll3 = table3.roll().results[0].text;\n\nlet content = `${roll1}<br> ${roll2}.<br> ${roll3}`\n\nChatMessage.create({content: content})","author":"eUp50nEprJoNBigj","img":"icons/svg/dice-target.svg","actorIds":[]}
